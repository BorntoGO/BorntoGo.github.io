##Androidè°ƒç”¨Cå‡½æ•°

###æ¦‚å¿µå‡†å¤‡
ä¸ºäº†å®Œæˆæ ‡é¢˜,å…ˆçœ‹å‡ ä¸ªæ¦‚å¿µ:

- JNI: Java Native Interface,Javaæä¾›,ç”¨æ¥å®ç°Javaå’ŒCçš„äº’ç›¸è°ƒç”¨,ä½†æ˜¯ä½¿Javaä¸§å¤±äº†è·¨å¹³å°çš„ç‰¹æ€§.
- NDK: Native Development Kit,Androidæä¾›,åŸºäºJNI,è·¨å¹³å°.
- ç¼–è¯‘: CPUæœ€å¸¸è§çš„å³ARMå’Œx86,äº¤å‰ç¼–è¯‘å°±æ˜¯åœ¨ä¸€ä¸ªå¹³å°ä¸Šç¼–è¯‘å‡ºå¦ä¸€ä¸ªå¹³å°å¯ç”¨çš„ä»£ç ,
NDKå°±æ˜¯äº¤å‰ç¼–è¯‘å·¥å…·.
- ä¸ºä½•ä½¿ç”¨NDK,æŠ„è¿‡æ¥ä»¥ä¸‹å‡ ç‚¹:
  - æ–¹ä¾¿è·¨å¹³å°.
  - ç®—æ³•å¤æ‚æˆ–èµ„æºæ¶ˆè€—å¤§çš„æ¨¡å—.
  - å¯ä»¥é¿å…æ ¸å¿ƒä»£ç è¢«åç¼–è¯‘.

###å·¥å…·å‡†å¤‡
ä¸‹é¢ä¸»è¦è®²å¦‚ä½•åœ¨MAC OS X ä¸Šä½¿ç”¨NDK

- å®‰è£…AndroidStudio,é€‰æ‹©ASæ˜¯å› ä¸ºå„ç§å¼ºå¤§çš„æ’ä»¶,è‡ªåŠ¨è¡¥å…¨,çº é”™æç¤º,æœ€åè¿˜æœ‰å®˜æ–¹å‡ºå“.
- å®‰è£…NDK,å®˜ç½‘ä¸‹è½½,è§£å‹`chmod a+x xx.bin` `./xx.bin`

###å¼€å§‹
1. æ–°å»ºä¸€ä¸ªç©ºç™½å·¥ç¨‹,å…·ä½“å†…å®¹è¯·å‚è€ƒ:[Building Your First App](http://developer.android.com/intl/zh-cn/training/basics/firstapp/index.html)

2. ä½¿ç”¨Projectè§†å›¾,åœ¨é¡¹ç›®ä¸»ç›®å½•å³é”®æ–°å»ºä¸€ä¸ªåä¸º`method`çš„æ¨¡å—,
`New - Module - Android Library - Add No Activity - Finish`.
3. åœ¨appæ¨¡å—çš„`MainActivity.java`æ·»åŠ nativeæ–¹æ³•

        public class MainActivity extends AppCompatActivity {
            public native int add(int a, int b);

   æ­¤å¤„çš„addå¯¹åº”åé¢cæ–‡ä»¶ä¸­çš„æ–¹æ³•(æ³¨æ„å¯¹è±¡ç±»å‹æŸ¥çœ‹æœ«å°¾é“¾æ¥)å’Œhå¤´æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆ.
4. ç”Ÿæˆå¤´æ–‡ä»¶
 
   methodæ¨¡å—æ ¹ç›®å½•æ–°å»ºä¸€ä¸ª`autojavah.sh`ç”¨æ¥ç”Ÿæˆ`.h`å¤´æ–‡ä»¶ :


        #!/usr/bin/env bash
        export ProjectPath=$(cd "../$(dirname "$1")"; pwd)
        export TargetClassName="com.yanze.ajnidemo.MainActivity"

        export SourceFile="${ProjectPath}/app/src/main/java"
        export TargetPath="${ProjectPath}/method/src/main/jni"

        cd "${SourceFile}"
        javah -d ${TargetPath} -classpath "${SourceFile}" "${TargetClassName}"
        echo -d ${TargetPath} -classpath "${SourceFile}" "${TargetClassName}"

    å‰å››è¡Œå®šä¹‰,åä¸¤è¡Œæ‰§è¡Œ,æœ€åechoä¸€ä¸‹,ç…§ç€è‡ªå·±æ”¹,æ³¨æ„ä¸€ä¸‹`TargetPath`è¿™ä¸ª.
    åˆ›å»ºå®Œæˆåä¼šæç¤ºå®‰è£…`Bash Plugin`,å®‰è£…åé‡å¯AS,å³é”®Run(æˆ–è€…å»ç›®å½•è‡ªå·±è¿è¡Œ).


    ç”Ÿæˆçš„`.h`å¤´æ–‡ä»¶:

 
        /* DO NOT EDIT THIS FILE - it is machine generated */
        #include <jni.h>
        /* Header for class com_yanze_ajnidemo_MainActivity */

        #ifndef _Included_com_yanze_ajnidemo_MainActivity
        #define _Included_com_yanze_ajnidemo_MainActivity
        #ifdef __cplusplus
        extern "C" {
        #endif
        /*
        * Class:     com_yanze_ajnidemo_MainActivity
        * Method:    add
        * Signature: (II)I
        */
        JNIEXPORT jint JNICALL Java_com_yanze_ajnidemo_MainActivity_add
        (JNIEnv *, jobject, jint, jint);
 
        #ifdef __cplusplus
        }
        #endif
        #endif


   æ ¹æ®appæ¨¡å—`MainActivity.java`ä¸­çš„addæ–¹æ³•å¯¹åº”ç”Ÿæˆäº†ä¸€ä¸ªaddæ–¹æ³•.æ³¨æ„å¯¹è±¡ç±»å‹(jint)å’Œå‘½åè§„åˆ™.
   
5. add.cæ–‡ä»¶:
    
        // Created by Kyle on 15/11/19.
        #include "com_yanze_ajnidemo_MainActivity.h" 
        #include <stdio.h>

        JNIEXPORT jint JNICALL Java_com_yanze_ajnidemo_MainActivity_add(JNIEnv * env,jobject thiz, jint a, jint b){
        int c = a + b;
        return c;
        }
   
    
    æ³¨æ„c++å’Œcå†™æ³•ç•¥æœ‰ä¸åŒ.

6. ç¼–è¯‘
   1. é…ç½®NDKç¯å¢ƒ,åœ¨æ ¹ç›®å½•"local.properties"æ–‡ä»¶æœ«å°¾æ·»åŠ NDKçš„ç›®å½•,æˆ‘çš„æ˜¯:
   `ndk.dir=/Users/kyle/workspace/ndk/android-ndk-r10e`
   2. åœ¨"method"æ¨¡å—ä¸‹çš„"gradle.properties"æœ«å°¾æ·»åŠ `android.useDeprecatedNdk=true`.
   3. ç¼–è¯‘:å³é”®`method`æ¨¡å—,`make module`,æˆåŠŸåä¼šç”Ÿæˆ
   `libmethod.so(/Ajnidemo/method/build/intermediates/ndk/release/lib/å„å¹³å°/libmethod.so)`
   å’Œ
   `Android.mk(/Ajnidemo/method/build/intermediates/ndk/release/Android.mk)`ä¸¤ä¸ªæ–‡ä»¶.
   
       libmethod.soå¼•ç”¨æ—¶åå­—æ˜¯"method",Android.mkå†³å®šäº†ç¼–è¯‘æ—¶çš„é…ç½®(è¯¦ç»†è¯´æ˜è§å¼•ç”¨é“¾æ¥).
   4. ç»™appæ¨¡å—æ·»åŠ methodä¾èµ–.`å³é”®appæ¨¡å— - Open Module Setting - Dependencies - + - Module Dependency - method`.
   
7. åŠ è½½åº“æ–‡ä»¶.appæ¨¡å—çš„MainActivityç±»ä¸‹:
    
 
        static{
            System.loadLibrary("method");
        }
   
   
   è°ƒç”¨addæ–¹æ³•(ç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œ),å†™åœ¨onCreateä¸‹,ä»¥ä¾¿å¯åŠ¨æ—¶æ˜¾ç¤º.
      
   
       TextView tv = new TextView(this);
       MainActivity t = new MainActivity();
       int c = t.add(1024,233);
       String s = Integer.toString(c);
       tv.setText(s);
       setContentView(tv);   
   
   å†åŠ å‡ ä¸ªè¾“å…¥æ¡†å’ŒæŒ‰é’®å°±å¯ä»¥åšæˆä¸€ä¸ªè®¡ç®—å™¨äº†,å—¯.
   
   æœ€åä¸æƒ³æ”¾ä¸Šæ¥çš„æ•ˆæœå›¾ğŸ˜­
   
   ![æ•ˆæœå›¾](../images/2015112001.JPG)
   


###ç›¸å…³é“¾æ¥
è™½ç„¶å·¥å…·ä¸åŒ,æ–¹å¼ä¸ä¸€,è›‹æ•´ä½“çš„æ€è·¯æ˜¯ä¸€æ ·çš„,å…·ä½“æ“ä½œå¯ä»¥å‚ç…§ç¬¬äºŒä¸ªé“¾æ¥.

- http://blog.csdn.net/shulianghan/article/details/18964835

- http://blog.csdn.net/ashqal/article/details/21869151

- http://blog.csdn.net/redoffice/article/details/6654714

- http://xiazdong.me/2015/09/17/introduction-jni-ndk/

- JNIæ•°æ®ç±»å‹
http://www.jianshu.com/p/f1134503cd8e

- å®˜æ–¹é“¾æ¥,è›‹æ˜¯ç”¨çš„Eclips
http://developer.android.com/intl/zh-cn/ndk/index.html

- å®˜æ–¹æä¾›çš„sample
https://github.com/googlesamples/android-ndk